<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkmate: Puzzle Dash</title>
<style>
  body {
    font-family: sans-serif;
    background: #264d21;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    margin: 0;
    color: #fff;
  }
  #game {
    width: 90vmin;
    height: 90vmin;
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    grid-template-rows: repeat(8, 1fr);
    position: relative;
    border: 4px solid #111;
    background: #437d3c;
  }
  .cell {
    border: 1px solid #333;
    position: relative;
    background: rgba(255,255,255,0.1);
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .cell:nth-child(even) { background: rgba(255,255,255,0.05); }
  .piece {
    width: 70%;
    height: 70%;
    background: #fff;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    color: #111;
    font-weight: bold;
    font-size: 1.2em;
  }
  .target {
    width: 50%;
    height: 50%;
    background: red;
    border-radius: 50%;
    position: absolute;
  }
  #info {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 1.2em;
    text-align: center;
  }
  button {
    margin-top: 10px;
    padding: 6px 12px;
    font-size: 1em;
  }
</style>
</head>
<body>
<div id="info">
  <span id="score">Score: 0</span> | <span id="pieceType">Piece: Pawn</span>
  <br>
  <button id="changePiece">Change Piece</button>
</div>
<div id="game"></div>

<script>
// --- GAME STATE ---
const gameDiv = document.getElementById("game");
const scoreSpan = document.getElementById("score");
const pieceTypeSpan = document.getElementById("pieceType");
const changeBtn = document.getElementById("changePiece");

const PIECES = ["Pawn","Rook","Knight","Bishop","Queen","King"];
let pieceTypeIndex = 0;
let pieceType = PIECES[pieceTypeIndex];
let score = 0;
let board = Array.from({length:8},()=>Array(8).fill(null));
let piecePos = [7,0];
let targets = [];

// --- RENDER ---
function renderBoard() {
  gameDiv.innerHTML = "";
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const cell = document.createElement("div");
      cell.className = "cell";
      cell.dataset.r = r;
      cell.dataset.c = c;
      cell.onclick = ()=>cellClick(r,c);
      gameDiv.appendChild(cell);
    }
  }
  renderPiece();
  renderTargets();
}
function renderPiece(){
  const [r,c] = piecePos;
  const cells = gameDiv.children;
  const cell = cells[r*8+c];
  const div = document.createElement("div");
  div.className = "piece";
  div.textContent = pieceType[0];
  cell.appendChild(div);
}
function renderTargets(){
  const cells = gameDiv.children;
  for(const t of targets){
    const cell = cells[t[0]*8+t[1]];
    const div = document.createElement("div");
    div.className = "target";
    cell.appendChild(div);
  }
}
function updateInfo(){
  scoreSpan.textContent = "Score: "+score;
  pieceTypeSpan.textContent = "Piece: "+pieceType;
}

// --- PIECE LOGIC ---
function validMove(r1,c1,r2,c2,type){
  const dr=r2-r1, dc=c2-c1;
  switch(type){
    case "Pawn": return dr===-1 && dc===0;
    case "Rook": return dr===0 || dc===0;
    case "Bishop": return Math.abs(dr)===Math.abs(dc);
    case "Knight": return (Math.abs(dr)===2 && Math.abs(dc)===1)||(Math.abs(dr)===1 && Math.abs(dc)===2);
    case "Queen": return (dr===0||dc===0)||Math.abs(dr)===Math.abs(dc);
    case "King": return Math.abs(dr)<=1 && Math.abs(dc)<=1;
  }
  return false;
}

// --- CLICK ---
function cellClick(r,c){
  if(validMove(piecePos[0],piecePos[1],r,c,pieceType)){
    piecePos=[r,c];
    // check for targets
    for(let i=0;i<targets.length;i++){
      if(targets[i][0]===r && targets[i][1]===c){
        targets.splice(i,1);
        score++;
        break;
      }
    }
    renderBoard();
    updateInfo();
  }
}

// --- TARGETS ---
function spawnTarget(){
  let r=Math.floor(Math.random()*8);
  let c=Math.floor(Math.random()*8);
  // don't spawn on piece
  if(r===piecePos[0] && c===piecePos[1]) return;
  targets.push([r,c]);
  if(targets.length>3) targets.shift();
  renderBoard();
}

// --- CHANGE PIECE ---
changeBtn.onclick = ()=>{
  pieceTypeIndex = (pieceTypeIndex+1)%PIECES.length;
  pieceType = PIECES[pieceTypeIndex];
  updateInfo();
  renderBoard();
}

// --- MAIN LOOP ---
renderBoard();
updateInfo();
setInterval(spawnTarget,2000);

</script>
</body>
</html>
