<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Live Chess Instructor (Free, No Account)</title>
  <style>
    body { font-family: sans-serif; background: #f5f5f7; }
    #container { max-width: 500px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #aaa; padding: 24px; }
    #board { text-align: center; margin-bottom: 16px; }
    #controls { display: flex; gap: 8px; margin-bottom: 8px; }
    #moves { background: #fafafa; border: 1px solid #eee; border-radius: 6px; padding: 8px; margin-bottom: 16px; font-size: 0.95em; min-height: 32px; }
    .move { margin-right: 8px; }
    select, button, input[type="text"] { padding: 7px; border-radius: 4px; border: 1px solid #bbb; font-size: 1em; }
    button { background: #3369e7; color: #fff; border: none; }
    button:hover { background: #2856b6; }
    #inputMove { width: 120px; }
    .info { margin: 8px 0; color: #222;}
    .board-img { border-radius: 4px; border: 1px solid #ddd; max-width: 100%; min-width: 320px; min-height: 320px;}
    #helpInfo { margin-top: 8px; color: #1a5e23; }
  </style>
</head>
<body>
  <div id="container">
    <h2>Live Chess Instructor</h2>
    <div id="board"></div>
    <div id="controls">
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium" selected>Medium</option>
        <option value="hard">Hard</option>
      </select>
      <button id="helpBtn">Help (Best Move)</button>
      <button id="newBtn">New Match</button>
      <button id="replayBtn">Replay Match</button>
      <input type="text" id="inputMove" autocomplete="off" placeholder="Your move (e.g. e4)">
      <button id="playBtn">Play Move</button>
    </div>
    <div id="moves"></div>
    <div id="helpInfo"></div>
    <div id="info" class="info"></div>
  </div>
<script src="https://cdn.jsdelivr.net/npm/chess.js@1.0.0/chess.min.js"></script>
<script>
  // Uses chess.js (MIT, no account), chessboardimage.com for board, Lichess Explorer/Cloud Eval for bot and help
  const boardDiv = document.getElementById('board');
  const movesDiv = document.getElementById('moves');
  const inputMove = document.getElementById('inputMove');
  const playBtn = document.getElementById('playBtn');
  const newBtn = document.getElementById('newBtn');
  const replayBtn = document.getElementById('replayBtn');
  const helpBtn = document.getElementById('helpBtn');
  const infoDiv = document.getElementById('info');
  const difficultySel = document.getElementById('difficulty');
  const helpInfo = document.getElementById('helpInfo');

  let chess = new Chess();
  let gameMoves = [];
  let replaying = false;

  function updateBoard() {
    const fen = chess.fen().replace(/ /g,'_');
    boardDiv.innerHTML = `<img src="https://chessboardimage.com/${fen}.png" alt="Chessboard" class="board-img">`;
    movesDiv.innerHTML = chess.history({verbose:true}).map((m,i) => 
      `<span class="move">${i%2==0?(Math.floor(i/2)+1)+'.':''}${m.san}</span>`).join('');
    infoDiv.textContent = chess.game_over() ? (
      chess.in_draw() ? 'Draw!' : (chess.turn() === 'w' ? 'Black wins!' : 'White wins!')
    ) : 'Your turn: ' + (chess.turn() === 'w' ? 'White' : 'Black');
    inputMove.value = '';
    helpInfo.textContent = '';
  }

  async function botMove() {
    if (chess.game_over()) return;
    infoDiv.textContent = 'Bot thinking...';
    // Difficulty: easy = random legal, medium = frequent from Lichess, hard = best from Lichess Cloud Eval
    let move;
    if (difficultySel.value === 'easy') {
      const legal = chess.moves();
      move = legal[Math.floor(Math.random()*legal.length)];
    } else if (difficultySel.value === 'medium') {
      move = await getMostPopularMove(chess.fen());
    } else { // hard
      move = await getBestMove(chess.fen(), chess.turn());
    }
    if (move && chess.move(move)) {
      gameMoves.push(move);
      updateBoard();
    } else {
      infoDiv.textContent = "Bot cannot move.";
    }
  }

  async function getMostPopularMove(fen) {
    // Use Lichess opening explorer for most common move
    try {
      const res = await fetch(`https://explorer.lichess.ovh/masters?fen=${encodeURIComponent(fen)}`);
      const data = await res.json();
      if (data.moves && data.moves.length) return data.moves[0].san;
    } catch(e) {}
    // fallback: random
    const legal = chess.moves();
    return legal[Math.floor(Math.random()*legal.length)];
  }

  async function getBestMove(fen, turn) {
    // Use Lichess cloud eval for best move (may be slow, no account needed)
    try {
      const res = await fetch(`https://lichess.org/api/cloud-eval?fen=${encodeURIComponent(fen)}`);
      const data = await res.json();
      if (data.pvs && data.pvs[0] && data.pvs[0].moves) {
        const sanMove = fenToSan(fen, data.pvs[0].moves.split(' ')[0]);
        return sanMove;
      }
    } catch(e) {}
    // fallback: most popular
    return await getMostPopularMove(fen);
  }

  function fenToSan(fen, uci) {
    // Translate UCI move to SAN using chess.js
    const tmp = new Chess(fen);
    return tmp.move({from: uci.slice(0,2), to: uci.slice(2,4), promotion: uci.slice(4,5)}).san;
  }

  playBtn.onclick = () => {
    if (chess.game_over()) return;
    const move = inputMove.value.trim();
    if (!move) return;
    const legal = chess.moves();
    if (!legal.includes(move)) {
      infoDiv.textContent = "Illegal move. Try again.";
      return;
    }
    chess.move(move);
    gameMoves.push(move);
    updateBoard();
    setTimeout(botMove, 400);
  };

  newBtn.onclick = () => {
    chess = new Chess();
    gameMoves = [];
    replaying = false;
    updateBoard();
    infoDiv.textContent = "New match started.";
  };

  replayBtn.onclick = async () => {
    if (!gameMoves.length) return;
    chess = new Chess();
    replaying = true;
    updateBoard();
    infoDiv.textContent = "Replaying match...";
    for (const m of gameMoves) {
      await new Promise(r=>setTimeout(r, 650));
      chess.move(m);
      updateBoard();
    }
    replaying = false;
    infoDiv.textContent = "Replay complete.";
  };

  helpBtn.onclick = async () => {
    // Suggest best move for current position
    helpInfo.textContent = "Thinking...";
    let move;
    if (difficultySel.value === 'hard') {
      move = await getBestMove(chess.fen(), chess.turn());
      helpInfo.textContent = `Best move (engine): ${move}`;
    } else {
      move = await getMostPopularMove(chess.fen());
      helpInfo.textContent = `Popular move: ${move}`;
    }
  };

  // Start game
  updateBoard();
</script>
</body>
</html>
