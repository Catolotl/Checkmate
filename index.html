<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Checkmate RPG</title>
<style>
  body { background: #2e2e2e; color: #fff; font-family: sans-serif; text-align: center; }
  #board { display: grid; grid-template-columns: repeat(8, 60px); grid-template-rows: repeat(8, 60px); margin: 20px auto; }
  .cell { width: 60px; height: 60px; border: 1px solid #555; display: flex; align-items: center; justify-content: center; position: relative; }
  .cell.white { background: #eee; color: #000; }
  .cell.black { background: #666; }
  .piece { width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; cursor: pointer; position: absolute; top: 5px; left: 5px; }
  #info { margin: 10px; font-size: 1.2em; }
  .hp { position: absolute; bottom: 2px; left: 0; width: 100%; height: 5px; background: red; }
  .team { margin-top: 10px; }
</style>
</head>
<body>

<h1>Checkmate RPG</h1>
<div id="info">Select your piece to move</div>
<div id="board"></div>
<div class="team" id="playerTeam"></div>
<button onclick="restartGame()">Restart Game</button>

<script>
const PIECES = {
  pawn: {symbol:'â™™', hp:10, atk:3},
  rook: {symbol:'â™–', hp:15, atk:5},
  bishop: {symbol:'â™—', hp:12, atk:4},
  knight: {symbol:'â™˜', hp:12, atk:4},
  queen: {symbol:'â™•', hp:20, atk:7},
  king: {symbol:'â™”', hp:25, atk:6}
};

const ENEMIES_ORDER = ['pawn','pawn','rook','bishop','knight','queen','king'];

let board = Array.from({length:8},()=>Array(8).fill(null));
let playerPieces = [];
let selectedPiece = null;

// Initialize board and enemies
function initBoard() {
  const boardDiv = document.getElementById('board');
  boardDiv.innerHTML = '';
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let cell = document.createElement('div');
      cell.className = 'cell '+((r+c)%2===0?'white':'black');
      cell.dataset.r=r; cell.dataset.c=c;
      cell.onclick = ()=>cellClick(r,c);
      boardDiv.appendChild(cell);
    }
  }
  // Place player pawn at bottom middle
  addPlayerPiece('pawn',7,3);
  // Place enemies in top row
  for(let i=0;i<ENEMIES_ORDER.length;i++){
    addEnemyPiece(ENEMIES_ORDER[i],0,i);
  }
  renderBoard();
}

// Add player piece
function addPlayerPiece(type,r,c){
  let p = {type,typeObj:PIECES[type],r,c,hp:PIECES[type].hp};
  board[r][c]=p; playerPieces.push(p);
}

// Add enemy piece
function addEnemyPiece(type,r,c){
  let e = {type,typeObj:PIECES[type],r,c,hp:PIECES[type].hp,enemy:true};
  board[r][c]=e;
}

// Render board
function renderBoard(){
  const boardDiv = document.getElementById('board');
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      const cell = boardDiv.children[r*8+c];
      cell.innerHTML='';
      const piece = board[r][c];
      if(piece){
        let div = document.createElement('div');
        div.className='piece';
        div.innerHTML=piece.typeObj.symbol;
        if(selectedPiece===piece) div.style.border='2px solid yellow';
        let hpBar = document.createElement('div');
        hpBar.className='hp';
        hpBar.style.width=(piece.hp/piece.typeObj.hp*100)+'%';
        div.appendChild(hpBar);
        cell.appendChild(div);
      }
    }
  }
  updatePlayerTeam();
}

// Show player team
function updatePlayerTeam(){
  const teamDiv=document.getElementById('playerTeam');
  teamDiv.innerHTML='Team: '+playerPieces.map(p=>p.typeObj.symbol).join(' ');
}

// Handle clicks
function cellClick(r,c){
  const piece = board[r][c];
  if(selectedPiece){
    if(selectedPiece.r===r && selectedPiece.c===c){ selectedPiece=null; renderBoard(); return; }
    // If enemy, attack
    if(piece && piece.enemy){
      attack(selectedPiece,piece);
      selectedPiece=null;
      renderBoard();
      setTimeout(enemyTurn,300);
      return;
    }
    // Move to empty
    if(!piece){
      movePiece(selectedPiece,r,c);
      selectedPiece=null;
      renderBoard();
      setTimeout(enemyTurn,300);
      return;
    }
  } else if(piece && !piece.enemy){
    selectedPiece=piece;
    renderBoard();
  }
}

// Move piece
function movePiece(p,r,c){
  board[p.r][p.c]=null;
  p.r=r; p.c=c;
  board[r][c]=p;
}

// Attack
function attack(attacker,target){
  target.hp -= attacker.typeObj.atk;
  document.getElementById('info').innerText=`${attacker.typeObj.symbol} attacked ${target.typeObj.symbol} for ${attacker.typeObj.atk}!`;
  if(target.hp<=0){
    // Capture and convert to player if enemy
    board[target.r][target.c]=null;
    if(target.enemy) addPlayerPiece(target.type,target.r,target.c);
    checkVictory();
  }
}

// Enemy turn
function enemyTurn(){
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let e = board[r][c];
      if(e && e.enemy){
        // simple attack if adjacent
        let dirs=[[-1,0],[1,0],[0,-1],[0,1]];
        for(let [dr,dc] of dirs){
          let nr=r+dr,nc=c+dc;
          if(nr>=0&&nr<8&&nc>=0&&nc<8){
            let p = board[nr][nc];
            if(p && !p.enemy){
              p.hp -= e.typeObj.atk;
              document.getElementById('info').innerText=`${e.typeObj.symbol} attacked ${p.typeObj.symbol} for ${e.typeObj.atk}!`;
              if(p.hp<=0){
                board[p.r][p.c]=null;
                playerPieces = playerPieces.filter(x=>x!==p);
                checkVictory();
              }
              break;
            }
          }
        }
      }
    }
  }
  renderBoard();
}

// Victory / Game Over
function checkVictory(){
  let enemyCount=0;
  let kingAlive=false;
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let p=board[r][c];
      if(p && p.enemy){
        enemyCount++;
        if(p.type==='king') kingAlive=true;
      }
    }
  }
  if(enemyCount===0 || !kingAlive){
    document.getElementById('info').innerText='ðŸŽ‰ You Win!';
  } else if(playerPieces.length===0){
    document.getElementById('info').innerText='ðŸ’€ Game Over!';
  }
}

// Restart
function restartGame(){
  board = Array.from({length:8},()=>Array(8).fill(null));
  playerPieces=[];
  selectedPiece=null;
  initBoard();
}

initBoard();
</script>

</body>
</html>
